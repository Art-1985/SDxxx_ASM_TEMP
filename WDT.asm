INCLUDE "SD028.INC"

DLY1 == 0x80
	
ORG 0x0000

	JMP INITIAL


ORG 0x0050
	
INITIAL:
;	CALL DELAY
	SBANK 0
	MOV A,@0x0F
	MOV IOCR5,A

	;CLR P5
	;MOV A,P5
	;AND	A,0X0F
	;ADD PCL,A
	;JMP WDT_SCAL_1_SLEEPtoNORMAL	;0 16ms
	;JMP WDT_SCAL_2_SLEEPtoNORMAL	;1 128ms
	;JMP WDT_SCAL_4_SLEEPtoNORMAL	;2 256ms
	;JMP WDT_SCAL_8_SLEEPtoNORMAL	;3 512ms
	;JMP WDT_SCAL_16_SLEEPtoNORMAL	;4 1024ms
	;JMP WDT_SCAL_32_SLEEPtoNORMAL	;5 2048ms
	;JMP WDT_SCAL_64_SLEEPtoNORMAL	;6 4096ms
	;JMP WDT_SCAL_128_SLEEPtoNORMAL	;7 8192ms
	;JMP WDT_SCAL_256_SLEEPtoNORMAL	;8 16384ms
	;JMP WDT_SCAL_1_IDLEtoNORMAL		;9
	;JMP WDT_SCAL_1_NORMAL			;10
	;JMP WDT_SCAL_1_GREENtoNORMAL	;11
	;JMP WDT_SCAL_1_NORMALtoGREEN	;12
	;JMP WDT_SCAL_1_GREEN			;13
	;JMP WDT_SCAL_1_SLEEPtoGREEN		;14
	JMP WDT_SCAL_1_IDLEtoGREEN		;15
/*
HLFS=1 and 0
Fmain	Fsub	Pin-Reset / WDT
				N / G / I			S
RC		RC	WSTO + 6*1/Fsub		WSTO + 6*1/Fsub
	
Fsub=128KHz
*/

WDT_SCAL_1_SLEEPtoNORMAL:;0
	BC IDLE
	;BS HLFS
	MOV A,@0b00000000
	JMP WDT_SUB_LOOP
	
WDT_SCAL_2_SLEEPtoNORMAL:;1
	BC IDLE
	MOV A,@0b00001000
	JMP WDT_SUB_LOOP

WDT_SCAL_4_SLEEPtoNORMAL:;2
	BC IDLE
	MOV A,@0b00001001
	JMP WDT_SUB_LOOP

WDT_SCAL_8_SLEEPtoNORMAL:;3
	CALL	DELAY
	BC IDLE
	MOV A,@0b00001010
	JMP WDT_SUB_LOOP

WDT_SCAL_16_SLEEPtoNORMAL:;4
	CALL	DELAY
	BC IDLE
	MOV A,@0b00001011
	JMP WDT_SUB_LOOP

WDT_SCAL_32_SLEEPtoNORMAL:;5
	CALL	DELAY
	BC IDLE
	MOV A,@0b00001100
	JMP WDT_SUB_LOOP

WDT_SCAL_64_SLEEPtoNORMAL:;6
	CALL	DELAY
	BC IDLE
	MOV A,@0b00001101
	JMP WDT_SUB_LOOP

WDT_SCAL_128_SLEEPtoNORMAL:;7
	CALL	DELAY
	BC IDLE
	MOV A,@0b00001110
	JMP WDT_SUB_LOOP

WDT_SCAL_256_SLEEPtoNORMAL:;8
	CALL	DELAY
	BC IDLE
	MOV A,@0b00001111
	JMP WDT_SUB_LOOP
	
WDT_SCAL_1_IDLEtoNORMAL:;9
	BS IDLE
	MOV A,@0b00000000
	JMP WDT_SUB_LOOP

WDT_SCAL_1_NORMAL:;10
	BS CPUS
	CALL	DELAY
	CLR WDTCR
	BS WDTE
	BS P5,5
	WDTC
	JMP $
	
WDT_SCAL_1_GREENtoNORMAL:;11
	BC CPUS
	MOV A,@0b00000000
	MOV WDTCR,A
	BS WDTE
	BS P5,5
	WDTC
	JMP $
	
WDT_SCAL_1_NORMALtoGREEN:;12
	BS CPUS
	MOV A,@0b00000000
	MOV WDTCR,A
	BS WDTE
	BS P5,5
	WDTC
	JMP $
	
WDT_SCAL_1_GREEN:;13
	MOV A,@0b00000000
	MOV WDTCR,A
	BS WDTE
	BS P5,5
	WDTC
	JMP $
		
WDT_SCAL_1_SLEEPtoGREEN:;14
	BC IDLE
;	BC CPUS
	MOV A,@0b00000000
	JMP WDT_SUB_LOOP

WDT_SCAL_1_IDLEtoGREEN:;15
	BS IDLE
;	BC CPUS
	MOV A,@0b00000000
	JMP WDT_SUB_LOOP
	
WDT_SUB_LOOP:
	MOV WDTCR,A
	BS WDTE
	BS P5,5
	WDTC
	SLEP
	JMP $
	
DELAY:
	SBANK 0
	BC CPUS
	MOV A,@100
	MOV DLY1,A
DELAY_LOOP1:
	DJZ DLY1
	JMP DELAY_LOOP1
	BS CPUS
	RET
	
	END