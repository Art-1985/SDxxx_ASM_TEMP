;ORG 	0x03FF
;SDxxx_SYS_INIT:	
    ;SDxxx_SYS_INIT
    ;RET


;;====== For IC Application =================================================;;
SDxxx_SYS_INIT MACRO
    SBANK	0
    BS		CPUS
    BS		IDLE
    ENDM

DELAY_NOP_NO_10	MACRO
    NOP
    NOP
    NOP
    NOP
    NOP
    NOP
    NOP
    NOP
    NOP
    NOP
    ENDM

DELA_NOP_NO_100 MACRO
	SBANK 	0
	BC 		CPUS
	MOV 	A,@100
	MOV 	0x80,A	;RAM(0x80)
	DELAY_LOOP1:
		DJZ 0x80
		JMP DELAY_LOOP1
		BS CPUS
	ENDM



SDxxx_RAM_TABLE MACRO
    MOV		A,@0x80		; Write Start SRAM
    MOV		RSR,A
    GBANK	3
    MOV		A,@0x55		; SRAM(0x0085)
    MOV		IAR,A
    INC		RSR
    MOV		A,@0xAA
    MOV		IAR,A
    INC		RSR		
    MOV		A,@0xF0
    XOR		A,RSR		; INC(0x80),UNTIL(0xC0)
    JBS		Z
    JMP		$-9
    ENDM

SDxxx_IAP_WR MACRO
    SBANK	1		
    MOV		A,@0x00
    MOV		TBWAL,A
    MOV		A,@0x0C
    MOV		TBWAH,A
    MOV		A,@0x01
    MOV		TBWCR,A
    MOV		A,@0xB4
    MOV		FLKR,A
    TBWR
    ENDM

SDxxx_IAP_RD MACRO
	GBANK	0
    MOV		A,@0x80
    MOV		TMP4,A
    MOV		A,@0x00
    MOV		TMP3,A			
    TEXT1:
    MOV		A,TMP4
    MOV		RSR,A
    SBANK	1
    MOV		A,TMP3	; Set ROM Pointer
    MOV		TBPTL,A
    MOV		A,@0x0C
    MOV		TBPTH,A
    TBRDA	TMP5	; A(LowByte),TMP5(HiByte)
    MOV		IAR,A
    INC		RSR
    MOV		A,TMP5
    MOV		IAR,A
    INC		TMP3
    INC		TMP4
    INC		TMP4
    MOV		A,TMP4
    XOR		A,@0xC0
    JBS		Z
    JMP		TEXT1
    ENDM

SDxxx_ROM_PROTECT   MACRO RANGE
	SBANK	2
	BS		LOCKEN
	SBANK	1
	MOV		A,@0xC5
	MOV		FLKR,A
	SBANK	2
	MOV		A,@RANGE    ;0x01
	MOV		LOCKPR,A	;Lock(0x0000~0x007F)
    ENDM
SDxxx_ROM_READ  MACRO ADDR_H,ADDR_L,BYTE_H
	SBANK	1
	MOV		A,@ADDR_L
	MOV		TBPTL,A
	MOV		A,@ADDR_H
	MOV		TBPTH,A
	TBRDA	BYTE_H	    ;A(LowByte),TMP5(HiByte)
    ENDM

SDxxx_WDT_SET MACRO
	SBANK	0
	MOV		A,@0x88
	MOV		WDTCR,A
    ENDM
;;====== For IC Function Verify =============================================;;
SDxxx_WR_COBS_IRC MACRO
	SBANK	1
	MOV		A,@0xA0
	MOV		COBS1,A
    MOV		A,@0x3F
	MOV		COBS2,A
    MOV		A,@0x0F
	MOV		COBS3,A
	SBANK	2
	MOV		A,@0x1F
	MOV		COBS4,A
    MOV		A,@0x3F
	MOV		COBS2,A
    MOV		A,@0x0F
	MOV		COBS3,A
    ENDM


;RAM_WRITE MACRO G_BANK,START_ADDR,VALUE
; GBANK G_BANK
; MOV A,@START_ADDR
; MOV RSR,A
; MOV A,@VALUE
; MOV IAR,A
; INC RSR
; JBS Z
; JMP $-3
;ENDM


;驗證BSR(SBANK)
SD028_SYS_SBANK MACRO
    SBANK   0
    GBANK   0
    MOV     A,@0x00
    XOR     A,BSR
    JBS		Z
    JMP     INS_FAIL
        MOV     A,BSR 
        XOR     A,@0x00
        JBS		Z
        JMP     INS_FAIL
	SBANK	1
    MOV     A,@0x10
    XOR     A,BSR
    JBS		Z
    JMP     INS_FAIL
        MOV     A,BSR 
        XOR     A,@0x10
        JBS		Z
        JMP     INS_FAIL
    SBANK	2
    MOV     A,@0x20
    XOR     A,BSR
    JBS		Z
    JMP     INS_FAIL
        MOV     A,BSR 
        XOR     A,@0x20
        JBS		Z
        JMP     INS_FAIL
    SBANK	3
    MOV     A,@0x30
    XOR     A,BSR
    JBS		Z
    JMP     INS_FAIL
        MOV     A,BSR 
        XOR     A,@0x30
        JBS		Z
        JMP     INS_FAIL
    ENDM

SDxxx_WDT_IDLE_NORMAL MACRO
	SBANK	 0
	MOV 	A,@0x0F
	MOV 	IOCR5,A
	BS 		IDLE
	;BS 	HLFS
	MOV 	A,@0b00000000
	MOV		WDTCR,A
	BS 		WDTE
	BS 		P5,5
	WDTC
	SLEP
	JMP 	$
	ENDM

SDxxx_WDT_NORMAL MACRO
	SBANK 	0
	MOV 	A,@0x0F
	MOV 	IOCR5,A
	BS 		CPUS
	DELA_NOP_NO_100
	CLR		WDTCR
	BS 		WDTE
	BS 		P5,5
	WDTC
	JMP 	$
	ENDM

SDxxx_WDT_GREEN_NNORMAL MACRO
	SBANK 	0
	MOV 	A,@0x0F
	MOV 	IOCR5,A
	BC 		CPUS
	MOV 	A,@0b00000000
	MOV 	WDTCR,A
	BS 		WDTE
	BS 		P5,5
	WDTC
	JMP 	$	
	ENDM

SDxxx_WDT_NORMAL_GREEN MACRO
	SBANK 	0
	MOV 	A,@0x0F
	MOV 	IOCR5,A
	BS 		CPUS
	MOV 	A,@0b00000000
	MOV 	WDTCR,A
	BS 		WDTE
	BS 		P5,5
	WDTC
	JMP 	$
	ENDM

SDxxx_WDT_GREEN MACRO
	SBANK 	0
	MOV 	A,@0x0F
	MOV 	IOCR5,A
	MOV 	A,@0b00000000
	MOV 	WDTCR,A
	BS 		WDTE
	BS 		P5,5
	WDTC
	JMP 	$
	ENDM

SDxxx_WDT_SLEEP_GREEN MACRO
	SBANK 	0
	MOV 	A,@0x0F
	MOV 	IOCR5,A
	BC 		IDLE
	;BC 		CPUS
	MOV 	A,@0b00000000
	MOV 	WDTCR,A
	BS 		WDTE
	BS 		P5,5
	WDTC
	SLEP
	JMP 	$
	ENDM

SDxxx_WDT_IDLE_GREEN MACRO
	SBANK 	0
	MOV 	A,@0x0F
	MOV 	IOCR5,A
	BS 		IDLE
	;BC 		CPUS
	MOV 	A,@0b00000000
	MOV 	WDTCR,A
	BS 		WDTE
	BS 		P5,5
	WDTC
	SLEP
	JMP 	$
	ENDM

SDxxx_WDT_SCAL_1_SLP_NOR MACRO  ; 16ms
	SBANK 0
	MOV     A,@0x0F
	MOV     IOCR5,A
	BC      IDLE
	MOV     A,@0b00000000
	MOV     WDTCR,A
	BS      WDTE
	BS      P5,5
	WDTC
	SLEP
	JMP     $
    ENDM

SDxxx_WDT_SCAL_2_SLP_NOR MACRO  ; 128ms
	SBANK 0
	MOV     A,@0x0F
	MOV     IOCR5,A
	BC      IDLE
	MOV     A,@0b00001000
	MOV     WDTCR,A
	BS      WDTE
	BS      P5,5
	WDTC
	SLEP
	JMP     $
    ENDM

SDxxx_WDT_SCAL_4_SLP_NOR MACRO  ; 256ms
	SBANK 0
	MOV     A,@0x0F
	MOV     IOCR5,A
	BC      IDLE
	MOV     A,@0b00001001
	MOV     WDTCR,A
	BS      WDTE
	BS      P5,5
	WDTC
	SLEP
	JMP     $
    ENDM

SDxxx_WDT_SCAL_8_SLP_NOR MACRO  ; 512ms
	SBANK 0
	MOV     A,@0x0F
	MOV     IOCR5,A
	BC      IDLE
	MOV     A,@0b00001010
	MOV     WDTCR,A
	BS      WDTE
	BS      P5,5
	WDTC
	SLEP
	JMP     $
    ENDM

SDxxx_WDT_SCAL_16_SLP_NOR MACRO  ; 1024ms
	SBANK 0
	MOV     A,@0x0F
	MOV     IOCR5,A
	BC      IDLE
	MOV     A,@0b00001011
	MOV     WDTCR,A
	BS      WDTE
	BS      P5,5
	WDTC
	SLEP
	JMP     $
    ENDM

SDxxx_WDT_SCAL_32_SLP_NOR MACRO  ; 2048ms
	SBANK 0
	MOV     A,@0x0F
	MOV     IOCR5,A
	BC      IDLE
	MOV     A,@0b00001100
	MOV     WDTCR,A
	BS      WDTE
	BS      P5,5
	WDTC
	SLEP
	JMP     $
    ENDM

SDxxx_WDT_SCAL_64_SLP_NOR MACRO  ; 4096ms
	SBANK 0
	MOV     A,@0x0F
	MOV     IOCR5,A
	BC      IDLE
	MOV     A,@0b00001101
	MOV     WDTCR,A
	BS      WDTE
	BS      P5,5
	WDTC
	SLEP
	JMP     $
    ENDM

SDxxx_WDT_SCAL_128_SLP_NOR MACRO  ; 8192ms
	SBANK 0
	MOV     A,@0x0F
	MOV     IOCR5,A
	BC      IDLE
	MOV     A,@0b00001110
	MOV     WDTCR,A
	BS      WDTE
	BS      P5,5
	WDTC
	SLEP
	JMP     $
    ENDM

SDxxx_WDT_SCAL_256_SLP_NOR MACRO  ; 16384ms
	SBANK 0
	MOV     A,@0x0F
	MOV     IOCR5,A
	BC      IDLE
	MOV     A,@0b00001111
	MOV     WDTCR,A
	BS      WDTE
	BS      P5,5
	WDTC
	SLEP
	JMP     $
    ENDM


